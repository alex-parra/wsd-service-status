"use strict";function dateFormat(e){return e.toLocaleDateString()+" "+e.toLocaleTimeString()}function getTemplate(e){const t=jQuery("#"+e);return!t.length&&console.error("Template not found:",e),t.length?t.html().trim():""}function getStatusClass(e,t="badge"){let r="info";return e>=500?r="danger":e>=400?r="warning":e<300&&(r="success"),t+"-"+r}function getAlertsClass(e,t=e,r="badge"){let o="info";return e<1?o="success":e>=t-1?o="danger":e>=t/2&&(o="warning"),r+"-"+o}function renderChecks(e=[],t=""){if(0===e.length)return'<li class="no-results">No checks to list.</li>';return e.map((function(e){let r=t;return r=r.replace("NODE_CHECK_NAME",e.name),r=r.replace("NODE_CHECK_MESSAGE",e.message),r=r.replace("NODE_CHECK_STATE",e.state),r})).join("")}function renderNodes(e=[],t="",r=""){if(0===e.length)return'<li class="no-results">No nodes to list.</li>';return e.map((function(e){let o=t;o=o.replace("NODE_NAME",e.web_node),o=o.replace("NODE_STATUS_CODE",e.status_code),o=o.replace("NODE_STATUS_CLASS",getStatusClass(e.status_code));const s=renderChecks(e.checks||[],r);return o=o.replace("NODE_CHECKS",s),o})).join("")}function servicesChart(e,t){c3.generate({bindto:$("[data-role=servicesHealth]").get(0),data:{columns:[["With errors",t],["Healthy",e]],colors:{"With errors":"#dc3545",Healthy:"#28a745"},type:"donut"},donut:{title:"Services",width:25,label:{format:function(e){return e}}}})}function nodesChart(e,t){c3.generate({bindto:$("[data-role=nodesHealth]").get(0),data:{columns:[["With errors",t],["Healthy",e]],colors:{"With errors":"#dc3545",Healthy:"#28a745"},type:"donut"},donut:{title:"Nodes",width:25,label:{format:function(e){return e}}}})}"undefined"!=typeof module&&(module.exports=getStatusClass),"undefined"!=typeof module&&(module.exports=getAlertsClass),function(e){const t=e(document),r={search:""};function o(e){e.service_reports.sort((function(e,t){return t.total_alerts+t.nodes.length-(e.total_alerts+e.nodes.length)})),e.servicesHealthy=0,e.servicesErrored=0,e.nodesHealthy=0,e.nodesErrored=0,e.totalNodes=0,e.service_reports.forEach((function(t){t.total_alerts>0?e.servicesErrored+=1:e.servicesHealthy+=1;const r=t.nodes||[];e.totalNodes+=r.length,e.nodesHealthy+=r.filter((function(e){return 0===e.total_alerts})).length,e.nodesErrored+=r.filter((function(e){return e.total_alerts>0})).length,t.max_alerts=r.reduce((function(e,t){return e+(t.checks||[]).length}),0),0===t.max_alerts&&(t.max_alerts=r.length)})),r.report=e}let s=null;function a(){s&&clearTimeout(s),s=setTimeout((function(){const t=r.report;e("[data-role=reportId]").text(t.job_id),e("[data-role=reportDate]").text(dateFormat(new Date(t.completed_at))),e("[data-role=servicesCount]").text(t.service_reports.length),servicesChart(t.servicesHealthy,t.servicesErrored),e("[data-role=nodesCount]").text(t.totalNodes),nodesChart(t.nodesHealthy,t.nodesErrored),e("[data-role=alertsCount]").text(t.total_alerts);const o=getTemplate("serviceCard"),s=r.search?new RegExp(r.search,"i"):null,a=t.service_reports.map((function(t){if(s&&!s.test(t.host.name))return;let r=o;return r=r.replace("HOST_NAME",t.host.name),r=r.replace("ALERTS_COUNT",t.total_alerts),r=r.replace("ALERTS_CLASS",getAlertsClass(t.total_alerts,t.max_alerts)),r=r.replace("STATUS_CODE",t.status_code),r=r.replace("STATUS_CLASS",getStatusClass(t.status_code)),r=r.replace("STATUS_TEXT",t.status_text),e(r).data("service",t.host.id)}));e("[data-role=services]").html(a)}),500)}t.on("keyup","[data-role=filter-services]",(function(e){r.search=e.target.value,a()}));const n=e(".service-modal").modal({show:!1}),l=getTemplate("serviceModal"),c=getTemplate("serviceModalNode"),d=getTemplate("serviceModalNodeCheck");t.on("click","[data-role=service-card]",(function(){const t=function(e){return r.report.service_reports.find((function(t){return t.host.id===Number(e)}))}(e(this).data("service"));let o=l;o=o.replace("HOST_NAME",t.host.name),o=o.replace("STATUS_CODE",t.status_code),o=o.replace("STATUS_CLASS",getStatusClass(t.status_code)),o=o.replace("STATUS_TEXT",t.status_text);const s=renderNodes(t.nodes,c,d);o=o.replace("SERVICE_NODES",s),n.find(".modal-body").html(o),n.modal("show")})),t.ready((function(){new Promise((function(t,r){e.ajax("/report",{method:"GET",success:t,error:r})})).then(o).then(a).catch(console.error)}))}(jQuery);